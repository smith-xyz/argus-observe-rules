rules:
  - id: c-crypto-diffie-hellman
    message: Diffie-Hellman key exchange detected
    severity: INFO
    languages:
      - c
    patterns:
      - pattern-either:
          - pattern: DH_new()
          - pattern: DH_generate_parameters_ex($DH, $PRIME_LEN, $GENERATOR, $BN)
          - pattern: DH_generate_key($DH)
          - pattern: DH_compute_key($KEY, $PUBKEY, $DH)
          - pattern: EVP_PKEY_new_DH($DH)
          - pattern: EVP_PKEY_assign_DH($PKEY, $DH)
          - pattern: EVP_PKEY_CTX_new_id(EVP_PKEY_DH, $ENGINE)
          - pattern: EVP_PKEY_derive_init($CTX)
          - pattern: EVP_PKEY_derive_set_peer($CTX, $PEER)
          - pattern: EVP_PKEY_derive($CTX, $KEY, $KEYLEN)
          - pattern: DH_set0_pqg($DH, $P, $Q, $G)
          - pattern: DH_get0_pqg($DH, $P, $Q, $G)
    metadata:
      category: crypto
      cwe: CWE-327
      impact: "Inventory: Diffie-Hellman key exchange detected in codebase"
