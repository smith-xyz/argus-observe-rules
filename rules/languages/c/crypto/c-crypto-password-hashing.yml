rules:
  - id: c-crypto-password-hashing
    message: Password hashing function usage detected
    severity: INFO
    languages:
      - c
    patterns:
      - pattern-either:
          - pattern: crypt($KEY, $SALT)
          - pattern: crypt_r($KEY, $SALT, $DATA)
          - pattern: bcrypt_hashpw($PASS, $SALT, $HASH)
          - pattern: bcrypt_checkpw($PASS, $HASH)
          - patterns:
              - pattern: argon2i_hash($T_COST, $M_COST, $PARALLELISM, $PWD, $PWD_LEN, $SALT, $SALT_LEN, $HASH, $HASH_LEN)
              - metavariable-regex:
                  metavariable: $T_COST
                  regex: '\d+'
              - metavariable-regex:
                  metavariable: $M_COST
                  regex: '\d+'
          - patterns:
              - pattern: argon2id_hash($T_COST, $M_COST, $PARALLELISM, $PWD, $PWD_LEN, $SALT, $SALT_LEN, $HASH, $HASH_LEN)
              - metavariable-regex:
                  metavariable: $T_COST
                  regex: '\d+'
              - metavariable-regex:
                  metavariable: $M_COST
                  regex: '\d+'
          - patterns:
              - pattern: argon2d_hash($T_COST, $M_COST, $PARALLELISM, $PWD, $PWD_LEN, $SALT, $SALT_LEN, $HASH, $HASH_LEN)
              - metavariable-regex:
                  metavariable: $T_COST
                  regex: '\d+'
              - metavariable-regex:
                  metavariable: $M_COST
                  regex: '\d+'
          - pattern: argon2i_verify($HASH, $PWD, $PWD_LEN)
          - pattern: argon2id_verify($HASH, $PWD, $PWD_LEN)
          - pattern: argon2d_verify($HASH, $PWD, $PWD_LEN)
    metadata:
      category: crypto
      cwe: CWE-327
      impact: "Inventory: Password hashing function usage detected in codebase"
