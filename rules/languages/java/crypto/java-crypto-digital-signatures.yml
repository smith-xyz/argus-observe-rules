rules:
  - id: java-crypto-digital-signatures
    message: Digital signature operations detected
    severity: INFO
    languages:
      - java
    patterns:
      - pattern-either:
          - pattern: Signature.getInstance("SHA256withRSA")
          - pattern: Signature.getInstance("SHA512withRSA")
          - pattern: Signature.getInstance("SHA256withRSA/PSS")
          - pattern: Signature.getInstance("SHA512withRSA/PSS")
          - pattern: Signature.getInstance("SHA256withECDSA")
          - pattern: Signature.getInstance("SHA512withECDSA")
          - pattern: Signature.getInstance("SHA256withDSA")
          - pattern: Signature.getInstance("SHA512withDSA")
          - pattern: Signature.getInstance("Ed25519")
          - pattern: Signature.getInstance("Ed448")
          - patterns:
              - pattern: Signature.getInstance($ALGO)
              - metavariable-regex:
                  metavariable: $ALGO
                  regex: '"(SHA[0-9]+with(RSA|ECDSA|DSA)|Ed25519|Ed448)"'
              - focus-metavariable: $ALGO
          - pattern: |
              $SIG = Signature.getInstance("SHA256withRSA");
              $SIG.initSign($PRIV_KEY);
              $SIG.update($DATA);
              $SIGNATURE = $SIG.sign();
          - pattern: |
              $SIG = Signature.getInstance("SHA256withRSA");
              $SIG.initVerify($PUB_KEY);
              $SIG.update($DATA);
              $VERIFIED = $SIG.verify($SIGNATURE);
          - pattern: |
              $SIG = Signature.getInstance("SHA256withECDSA");
              $SIG.initSign($PRIV_KEY);
              $SIG.update($DATA);
              $SIGNATURE = $SIG.sign();
          - pattern: |
              $SIG = Signature.getInstance("SHA256withRSA/PSS");
              $SIG.initSign($PRIV_KEY);
              $SIG.update($DATA);
              $SIGNATURE = $SIG.sign();
          - pattern: |
              $SIG = Signature.getInstance("Ed25519");
              $SIG.initSign($PRIV_KEY);
              $SIG.update($DATA);
              $SIGNATURE = $SIG.sign();
    metadata:
      category: crypto
      cwe: CWE-327
      impact: "Inventory: Digital signature operations detected in codebase"
