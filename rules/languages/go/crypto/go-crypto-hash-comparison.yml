rules:
  - id: go-crypto-hash-comparison
    message: Hash function used in comparison or verification detected
    severity: INFO
    languages:
      - go
    patterns:
      - pattern-either:
          - pattern: |
              $EXPECTED := md5.Sum($DATA)
              ...
              $ACTUAL := md5.Sum($OTHER)
              ...
              bytes.Equal($EXPECTED[:], $ACTUAL[:])
          - pattern: |
              $EXPECTED := sha1.Sum($DATA)
              ...
              $ACTUAL := sha1.Sum($OTHER)
              ...
              bytes.Equal($EXPECTED[:], $ACTUAL[:])
          - pattern: |
              $HASH1 := hex.EncodeToString(md5.Sum($DATA1))
              $HASH2 := hex.EncodeToString(md5.Sum($DATA2))
              ...
              $HASH1 == $HASH2
          - pattern: |
              $HASH1 := hex.EncodeToString(sha1.Sum($DATA1))
              $HASH2 := hex.EncodeToString(sha1.Sum($DATA2))
              ...
              $HASH1 == $HASH2
          - pattern: |
              if hex.EncodeToString(md5.Sum($DATA)) == $EXPECTED {
                ...
              }
          - pattern: |
              if hex.EncodeToString(sha1.Sum($DATA)) == $EXPECTED {
                ...
              }
    metadata:
      category: crypto
      cwe: CWE-327
      impact: "Inventory: Hash function used in comparison or verification detected in codebase"
