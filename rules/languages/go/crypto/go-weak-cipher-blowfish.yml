rules:
  - id: go-weak-cipher-blowfish
    message: Blowfish cipher is vulnerable to birthday attacks
    severity: WARNING
    languages:
      - go
    patterns:
      - pattern-either:
          - pattern: blowfish.NewCipher($KEY)
          - pattern: blowfish.NewSaltedCipher($KEY, $SALT)
          - pattern: $CIPHER := blowfish.NewCipher($KEY)
          - pattern: $CIPHER := blowfish.NewSaltedCipher($KEY, $SALT)
          - pattern: cipher.NewCBCDecrypter(blowfish.NewCipher($KEY), $IV)
          - pattern: cipher.NewCBCEncrypter(blowfish.NewCipher($KEY), $IV)
          - pattern: cipher.NewOFB(blowfish.NewCipher($KEY), $IV)
          - pattern: cipher.NewCFBDecrypter(blowfish.NewCipher($KEY), $IV)
          - pattern: cipher.NewCFBEncrypter(blowfish.NewCipher($KEY), $IV)
          - pattern: cipher.NewCTR(blowfish.NewCipher($KEY), $IV)
          - pattern: |
              $BLOCK := blowfish.NewCipher($KEY)
              ...
              cipher.NewCBCEncrypter($BLOCK, $IV)
          - pattern: |
              $BLOCK := blowfish.NewSaltedCipher($KEY, $SALT)
              ...
              cipher.NewCBCDecrypter($BLOCK, $IV)
          - pattern: var $CIPHER cipher.Block = blowfish.NewCipher($KEY)
          - pattern: $CIPHER := cipher.Block(blowfish.NewCipher($KEY))
          - pattern: |
              func $FNAME($CIPHER cipher.Block) {
                ...
              }
              ...
              $FNAME(blowfish.NewCipher($KEY))
    fix: "Use AES instead: aes.NewCipher()"
    metadata:
      category: crypto
      cwe: CWE-327
