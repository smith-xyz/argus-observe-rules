rules:
  - id: go-static-iv-reuse
    message: Static or reused initialization vector (IV) detected
    severity: ERROR
    languages:
      - go
    patterns:
      - pattern-either:
          - pattern: |
              $IV := []byte("$STATIC_VALUE")
              ...
              cipher.NewCBCEncrypter($BLOCK, $IV)
          - pattern: |
              $IV := make([]byte, $SIZE)
              ...
              cipher.NewCBCEncrypter($BLOCK, $IV)
          - pattern: |
              var $IV = []byte("$STATIC_VALUE")
              ...
              cipher.NewGCM($BLOCK).Seal($DST, $IV, $PLAINTEXT, $DATA)
          - pattern: cipher.NewCBCEncrypter($BLOCK, []byte("$STATIC_IV"))
          - pattern: cipher.NewCBCDecrypter($BLOCK, []byte("$STATIC_IV"))
    fix: "Generate random IVs for each encryption: crypto/rand.Read(iv)"
    metadata:
      category: crypto
      cwe: CWE-329
