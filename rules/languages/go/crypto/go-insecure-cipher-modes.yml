rules:
  - id: go-insecure-cipher-modes
    message: Insecure cipher mode detected
    severity: WARNING
    languages:
      - go
    patterns:
      - pattern-either:
          - pattern: cipher.NewOFB($BLOCK, $IV)
          - pattern: cipher.NewCFB($BLOCK, $IV)
          - pattern: |
              $STREAM := cipher.NewCTR($BLOCK, $IV)
              ...
              $STREAM.XORKeyStream($DST, $SRC)
          - pattern: |
              $MODE := cipher.NewCBCEncrypter($BLOCK, $IV)
              ...
              $MODE.CryptBlocks($DST, $SRC)
    fix: "Use authenticated encryption modes like GCM: cipher.NewGCM(block)"
    metadata:
      category: crypto
      cwe: CWE-327
