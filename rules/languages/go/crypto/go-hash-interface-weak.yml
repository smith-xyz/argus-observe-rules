rules:
  - id: go-hash-interface-weak
    message: Weak hash algorithm used via generic hash.Hash interface
    severity: WARNING
    languages:
      - go
    patterns:
      - pattern-either:
          - pattern: |
              func $FNAME($HASHER hash.Hash) {
                ...
              }
              ...
              $FNAME(md5.New())
          - pattern: |
              func $FNAME($HASHER hash.Hash) {
                ...
              }
              ...
              $FNAME(sha1.New())
          - pattern: |
              func $FNAME() hash.Hash {
                return md5.New()
              }
          - pattern: |
              func $FNAME() hash.Hash {
                return sha1.New()
              }
          - pattern: |
              $HASHERS := map[$KEY]hash.Hash{
                ...,
                $ENTRY: md5.New(),
                ...
              }
          - pattern: |
              $HASHERS := []hash.Hash{
                ...,
                md5.New(),
                ...
              }
    fix: "Use strong hash algorithms like SHA-256: sha256.New()"
    metadata:
      category: crypto
      cwe: CWE-327
      impact: Weak hash algorithms can compromise security even when used through generic interfaces
