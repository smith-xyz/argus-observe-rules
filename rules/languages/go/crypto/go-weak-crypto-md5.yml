rules:
  - id: go-weak-crypto-md5
    message: MD5 hash function is cryptographically weak
    severity: WARNING
    languages:
      - go
    patterns:
      - pattern-either:
          - pattern: md5.New()
          - pattern: md5.Sum($DATA)
          - pattern: |
              $HASHER := md5.New()
              $HASHER.Write($DATA)
              $HASH := $HASHER.Sum($SUFFIX)
          - pattern: |
              $HASHER := md5.New()
              ...
              $HASHER.Sum($SUFFIX)
          - pattern: crypto.MD5.New()
          - pattern: |
              $HASH := crypto.MD5
              $HASHER := $HASH.New()
          - pattern: var $HASHER hash.Hash = md5.New()
          - pattern: $HASHER := hash.Hash(md5.New())
          - pattern: hex.EncodeToString(md5.Sum($DATA))
          - pattern: base64.StdEncoding.EncodeToString(md5.Sum($DATA))
          - pattern: fmt.Sprintf("%x", md5.Sum($DATA))
          - pattern: fmt.Sprintf("%X", md5.Sum($DATA))
          - pattern: io.WriteString(md5.New(), $DATA)
          - pattern: |
              $HASHER := md5.New()
              io.Copy($HASHER, $READER)
          - pattern: hmac.New(md5.New, $KEY)
          - pattern: hmac.New(crypto.MD5.New, $KEY)
          - pattern: pbkdf2.Key($PASSWORD, $SALT, $ITER, $KEYLEN, md5.New)
          - pattern: pbkdf2.Key($PASSWORD, $SALT, $ITER, $KEYLEN, crypto.MD5.New)
          - pattern: $HASH := md5.Sum($DATA)
          - pattern: $CHECKSUM := md5.Sum($DATA)
    fix: "Use crypto/sha256 instead: sha256.New() or sha256.Sum256()"
    metadata:
      category: crypto
      cwe: CWE-327

      impact:
        MD5 is vulnerable to collision attacks and should not be used for security
        purposes
