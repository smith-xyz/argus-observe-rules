rules:
  - id: go-crypto-hardcoded-key
    message: Hardcoded cryptographic key detected
    severity: INFO
    languages:
      - go
    mode: taint
    pattern-sources:
      - pattern: $KEY := "$VALUE"
      - pattern: $KEY = "$VALUE"
      - pattern: var $KEY = "$VALUE"
      - pattern: var $KEY string = "$VALUE"
      - pattern: const $KEY = "$VALUE"
      - pattern: $KEY := []byte("$VALUE")
      - pattern: $KEY = []byte("$VALUE")
      - pattern: var $KEY = []byte("$VALUE")
      - pattern: var $KEY []byte = []byte("$VALUE")
      - pattern: |
          $KEY := os.Getenv("$ENV_VAR")
          if $KEY == "" {
            $KEY = "$DEFAULT_KEY"
          }
      - pattern: |
          $KEY := os.Getenv("$ENV_VAR")
          if len($KEY) == 0 {
            $KEY = "$DEFAULT_KEY"
          }
      - pattern: |
          type $CONFIG struct {
            $FIELD string
          }
          ...
          $CONFIG{$FIELD: "$KEY"}
      - pattern: |
          type $CONFIG struct {
            $FIELD []byte
          }
          ...
          $CONFIG{$FIELD: []byte("$KEY")}
      - pattern: $IV := "$STATIC_IV"
      - pattern: $IV = "$STATIC_IV"
      - pattern: const $IV = "$STATIC_IV"
      - pattern: var $IV = "$STATIC_IV"
      - pattern: aes.NewCipher([]byte("$KEY"))
      - pattern: cipher.NewCFBDecrypter($BLOCK, "$IV")
      - pattern: cipher.NewCFBEncrypter($BLOCK, []byte("$IV"))
      - pattern: cipher.NewCBCEncrypter($BLOCK, []byte("$IV"))
      - pattern: cipher.NewCBCDecrypter($BLOCK, []byte("$IV"))
      - pattern: cipher.NewOFB($BLOCK, []byte("$IV"))
    pattern-sinks:
      - pattern: aes.NewCipher($KEY)
      - pattern: aes.NewCipher([]byte($KEY))
      - pattern: des.NewCipher($KEY)
      - pattern: des.NewCipher([]byte($KEY))
      - pattern: rc4.NewCipher($KEY)
      - pattern: rc4.NewCipher([]byte($KEY))
      - pattern: cipher.NewCFBDecrypter($BLOCK, $IV)
      - pattern: cipher.NewCFBDecrypter($BLOCK, []byte($IV))
      - pattern: cipher.NewCFBEncrypter($BLOCK, $IV)
      - pattern: cipher.NewCFBEncrypter($BLOCK, []byte($IV))
      - pattern: cipher.NewCBCEncrypter($BLOCK, $IV)
      - pattern: cipher.NewCBCEncrypter($BLOCK, []byte($IV))
      - pattern: cipher.NewCBCDecrypter($BLOCK, $IV)
      - pattern: cipher.NewCBCDecrypter($BLOCK, []byte($IV))
      - pattern: cipher.NewOFB($BLOCK, $IV)
      - pattern: cipher.NewOFB($BLOCK, []byte($IV))
    metadata:
      category: crypto
      cwe: CWE-798
      impact: "Inventory: Hardcoded cryptographic key detected in codebase"
