rules:
  - id: go-predictable-nonce-gcm
    message: Predictable or reused nonce in GCM mode
    severity: ERROR
    languages:
      - go
    patterns:
      - pattern-either:
          - pattern: |
              $NONCE := []byte("$STATIC_VALUE")
              ...
              $GCM.Seal($DST, $NONCE, $PLAINTEXT, $DATA)
          - pattern: |
              $NONCE := make([]byte, $SIZE)
              ...
              $GCM.Seal($DST, $NONCE, $PLAINTEXT, $DATA)
          - pattern: $GCM.Seal($DST, []byte("$STATIC_NONCE"), $PLAINTEXT, $DATA)
          - pattern: |
              for $I := 0; $I < $N; $I++ {
                ...
                $GCM.Seal($DST, $NONCE, $PLAINTEXT, $DATA)
              }
    fix: "Generate unique random nonces for each encryption: crypto/rand.Read(nonce)"
    metadata:
      category: crypto
      cwe: CWE-329
