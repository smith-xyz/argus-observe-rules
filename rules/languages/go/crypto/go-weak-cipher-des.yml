rules:
  - id: go-weak-cipher-des
    message: DES encryption is cryptographically broken
    severity: ERROR
    languages:
      - go
    patterns:
      - pattern-either:
          - pattern: des.NewCipher($KEY)
          - pattern: des.NewTripleDESCipher($KEY)
          - pattern: $CIPHER := des.NewCipher($KEY)
          - pattern: $CIPHER := des.NewTripleDESCipher($KEY)
          - pattern: cipher.NewCBCDecrypter(des.NewCipher($KEY), $IV)
          - pattern: cipher.NewCBCEncrypter(des.NewCipher($KEY), $IV)
          - pattern: cipher.NewOFB(des.NewCipher($KEY), $IV)
          - pattern: cipher.NewCFBDecrypter(des.NewCipher($KEY), $IV)
          - pattern: cipher.NewCFBEncrypter(des.NewCipher($KEY), $IV)
          - pattern: cipher.NewCTR(des.NewCipher($KEY), $IV)
          - pattern: |
              $BLOCK := des.NewCipher($KEY)
              ...
              cipher.NewCBCEncrypter($BLOCK, $IV)
          - pattern: |
              $BLOCK := des.NewCipher($KEY)
              ...
              cipher.NewCBCDecrypter($BLOCK, $IV)
          - pattern: |
              $BLOCK := des.NewTripleDESCipher($KEY)
              ...
              cipher.NewCBCEncrypter($BLOCK, $IV)
          - pattern: var $CIPHER cipher.Block = des.NewCipher($KEY)
          - pattern: $CIPHER := cipher.Block(des.NewCipher($KEY))
          - pattern: |
              func $FNAME($CIPHER cipher.Block) {
                ...
              }
              ...
              $FNAME(des.NewCipher($KEY))
          - pattern: |
              $STREAM := cipher.NewOFB(des.NewCipher($KEY), $IV)
              $STREAM.XORKeyStream($DST, $SRC)
          - pattern: |
              $KEY24 := append($KEY8, $KEY8...)
              ...
              des.NewTripleDESCipher($KEY24)
    fix: "Use AES encryption instead: aes.NewCipher()"
    metadata:
      category: crypto
      cwe: CWE-327
