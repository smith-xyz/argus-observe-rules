rules:
  - id: go-tls-max-version-blocks-tls13
    message: TLS MaxVersion set to TLS 1.2 - This prevents TLS 1.3 and may override OpenShift TLS profile settings
    severity: WARNING
    languages:
      - go
    patterns:
      - pattern-either:
          # Direct MaxVersion assignment
          - pattern: $CONFIG.MaxVersion = tls.VersionTLS12
          # MaxVersion in struct initialization
          - pattern: |
              $CONFIG := &tls.Config{
                ...,
                MaxVersion: tls.VersionTLS12,
                ...
              }
          - pattern: |
              tls.Config{
                ...,
                MaxVersion: tls.VersionTLS12,
                ...
              }
          # Variable assignment pattern (short declaration)
          - pattern: |
              $VAR := tls.VersionTLS12
              ...
              $CONFIG.MaxVersion = $VAR
          # Variable assignment pattern (var declaration)
          - pattern: |
              var $VAR uint16 = tls.VersionTLS12
              ...
              $CONFIG.MaxVersion = $VAR
    fix: "Remove MaxVersion restriction or set to tls.VersionTLS13 to allow TLS 1.3"
    metadata:
      category: tls_runtime_security
      cwe: CWE-757
      impact: MaxVersion restriction prevents TLS 1.3, which may conflict with OpenShift TLS profile requiring TLS 1.3

  - id: go-tls-min-version-tls12-only
    message: TLS MinVersion set to TLS 1.2 without MaxVersion - May allow TLS 1.3 but worth reviewing for OpenShift profile compliance
    severity: INFO
    languages:
      - go
    patterns:
      - patterns:
          # MinVersion set to TLS 1.2
          - pattern-either:
              - pattern: $CONFIG.MinVersion = tls.VersionTLS12
              - pattern: |
                  $CONFIG := &tls.Config{
                    ...,
                    MinVersion: tls.VersionTLS12,
                    ...
                  }
          # But no MaxVersion set (or MaxVersion allows TLS 1.3)
          - pattern-not: |
              $CONFIG := &tls.Config{
                ...,
                MaxVersion: tls.VersionTLS12,
                ...
              }
          - pattern-not: $CONFIG.MaxVersion = tls.VersionTLS12
    fix: "Ensure MaxVersion is set to tls.VersionTLS13 or omitted to allow TLS 1.3"
    metadata:
      category: tls_runtime_security
      cwe: CWE-757
      impact: MinVersion without MaxVersion may allow TLS 1.3, but explicit configuration is recommended
