rules:
  - id: cpp-crypto-rsa
    message: RSA cryptographic operations detected
    severity: INFO
    languages:
      - cpp
    patterns:
      - pattern-either:
          - pattern: RSA_new()
          - patterns:
              - pattern: RSA_generate_key_ex($RSA, $BITS, $E, $BN)
              - metavariable-regex:
                  metavariable: $BITS
                  regex: '\d+'
              - focus-metavariable: $BITS
          - patterns:
              - pattern: RSA_generate_key($BITS, $E, $CALLBACK, $CALLBACKARG)
              - metavariable-regex:
                  metavariable: $BITS
                  regex: '\d+'
              - focus-metavariable: $BITS
          - patterns:
              - pattern: EVP_PKEY_Q_keygen($LIBCTX, $PROPS, "RSA", $BITS)
              - metavariable-regex:
                  metavariable: $BITS
                  regex: '\d+'
              - focus-metavariable: $BITS
          - patterns:
              - pattern: Botan::RSA_PrivateKey($RNG, $BITS)
              - metavariable-regex:
                  metavariable: $BITS
                  regex: '\d+'
              - focus-metavariable: $BITS
          - pattern: RSA_public_encrypt($FLEN, $FROM, $TO, $RSA, $PADDING)
          - pattern: RSA_private_decrypt($FLEN, $FROM, $TO, $RSA, $PADDING)
          - pattern: RSA_private_encrypt($FLEN, $FROM, $TO, $RSA, $PADDING)
          - pattern: RSA_public_decrypt($FLEN, $FROM, $TO, $RSA, $PADDING)
          - pattern: RSA_sign($TYPE, $M, $MLEN, $SIGRET, $SIGLEN, $RSA)
          - pattern: RSA_verify($TYPE, $M, $MLEN, $SIGBUF, $SIGLEN, $RSA)
          - pattern: EVP_PKEY_new_RSA($RSA)
          - pattern: EVP_PKEY_assign_RSA($PKEY, $RSA)
          - pattern: EVP_PKEY_CTX_new_id(EVP_PKEY_RSA, $ENGINE)
          - pattern: EVP_PKEY_keygen_init($CTX)
          - pattern: EVP_PKEY_keygen($CTX, $PKEY)
          - pattern: EVP_PKEY_fromdata($CTX, $SELECTION, $PARAMS)
          - pattern: EVP_PKEY_Q_keygen($LIBCTX, $PROPS, "RSA-PSS", $BITS)
          - pattern: EVP_PKEY_get0_RSA($PKEY)
          - pattern: CryptoPP::RSA::PrivateKey()
          - pattern: CryptoPP::RSA::PublicKey()
          - pattern: CryptoPP::RSAES_OAEP_SHA_Encryptor($PUBKEY)
          - pattern: CryptoPP::RSAES_OAEP_SHA_Decryptor($PRIVKEY)
          - pattern: CryptoPP::RSASS<CryptoPP::PSS, $HASH>::Signer($PRIVKEY)
          - pattern: CryptoPP::RSASS<CryptoPP::PKCS1v15, $HASH>::Verifier($PUBKEY)
          - pattern: Botan::RSA_PrivateKey($RNG, $BITS)
          - pattern: Botan::RSA_PublicKey($N, $E)
    metadata:
      category: crypto
      cwe: CWE-327
      impact: "Inventory: RSA cryptographic operations detected in codebase"
