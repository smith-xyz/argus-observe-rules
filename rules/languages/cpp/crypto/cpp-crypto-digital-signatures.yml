rules:
  - id: cpp-crypto-digital-signatures
    message: Digital signature operations detected
    severity: INFO
    languages:
      - cpp
    patterns:
      - pattern-either:
          - pattern: EVP_SignInit_ex($CTX, $TYPE, $ENGINE)
          - pattern: EVP_SignUpdate($CTX, $DATA, $DATALEN)
          - pattern: EVP_SignFinal($CTX, $SIG, $SIGLEN, $PKEY)
          - pattern: EVP_VerifyInit_ex($CTX, $TYPE, $ENGINE)
          - pattern: EVP_VerifyUpdate($CTX, $DATA, $DATALEN)
          - pattern: EVP_VerifyFinal($CTX, $SIG, $SIGLEN, $PKEY)
          - pattern: EVP_DigestSignInit($CTX, $PKCTX, $TYPE, $ENGINE, $PKEY)
          - pattern: EVP_DigestSignUpdate($CTX, $DATA, $DATALEN)
          - pattern: EVP_DigestSignFinal($CTX, $SIG, $SIGLEN)
          - pattern: EVP_DigestVerifyInit($CTX, $PKCTX, $TYPE, $ENGINE, $PKEY)
          - pattern: EVP_DigestVerifyUpdate($CTX, $DATA, $DATALEN)
          - pattern: EVP_DigestVerifyFinal($CTX, $SIG, $SIGLEN)
          - pattern: RSA_sign($TYPE, $M, $MLEN, $SIGRET, $SIGLEN, $RSA)
          - pattern: RSA_verify($TYPE, $M, $MLEN, $SIGBUF, $SIGLEN, $RSA)
          - pattern: ECDSA_sign($TYPE, $DGST, $DGSTLEN, $SIG, $SIGLEN, $ECKEY)
          - pattern: ECDSA_verify($TYPE, $DGST, $DGSTLEN, $SIG, $SIGLEN, $ECKEY)
          - pattern: CryptoPP::RSASS<CryptoPP::PSS, $HASH>::Signer($PRIVKEY)
          - pattern: CryptoPP::RSASS<CryptoPP::PKCS1v15, $HASH>::Signer($PRIVKEY)
          - pattern: CryptoPP::RSASS<CryptoPP::PSS, $HASH>::Verifier($PUBKEY)
          - pattern: CryptoPP::RSASS<CryptoPP::PKCS1v15, $HASH>::Verifier($PUBKEY)
          - pattern: CryptoPP::ECDSA<CryptoPP::ECP, $HASH>::Signer($PRIVKEY)
          - pattern: CryptoPP::ECDSA<CryptoPP::ECP, $HASH>::Verifier($PUBKEY)
          - patterns:
              - metavariable-pattern:
                  metavariable: $SIGNER
                  pattern-either:
                    - pattern: CryptoPP::RSASS<CryptoPP::PSS, $HASH>::Signer($PRIVKEY)
                    - pattern: CryptoPP::RSASS<CryptoPP::PKCS1v15, $HASH>::Signer($PRIVKEY)
                    - pattern: CryptoPP::ECDSA<CryptoPP::ECP, $HASH>::Signer($PRIVKEY)
              - pattern: $SIGNER.SignMessage($RNG, $MESSAGE, $SIGNATURE)
          - patterns:
              - metavariable-pattern:
                  metavariable: $VERIFIER
                  pattern-either:
                    - pattern: CryptoPP::RSASS<CryptoPP::PSS, $HASH>::Verifier($PUBKEY)
                    - pattern: CryptoPP::RSASS<CryptoPP::PKCS1v15, $HASH>::Verifier($PUBKEY)
                    - pattern: CryptoPP::ECDSA<CryptoPP::ECP, $HASH>::Verifier($PUBKEY)
              - pattern: $VERIFIER.VerifyMessage($MESSAGE, $SIGNATURE)
          - pattern: DSA_new()
          - pattern: DSA_generate_parameters_ex($DSA, $BITS, $SEED, $SEEDLEN, $COUNTER, $H_RET, $CALLBACK, $CALLBACKARG)
          - pattern: DSA_generate_key($DSA)
          - pattern: DSA_sign($TYPE, $DGST, $DGSTLEN, $SIG, $SIGLEN, $DSA)
          - pattern: DSA_verify($TYPE, $DGST, $DGSTLEN, $SIG, $SIGLEN, $DSA)
          - pattern: EVP_PKEY_CTX_new_id(EVP_PKEY_DSA, $ENGINE)
          - pattern: Botan::PK_Signer($SIGNER, $RNG)
          - pattern: Botan::PK_Verifier($VERIFIER)
    metadata:
      category: crypto
      cwe: CWE-327
      impact: "Inventory: Digital signature operations detected in codebase"
